# Реестр Архитектурных Правил

Этот документ определяет строгие, однозначные и проверяемые правила организации кода в проекте. Соблюдение этих правил обязательно для всех разработчиков и контролируется AI-ассистентами.

Правила обеспечивают консистентность кодовой базы в соответствии с ключевыми архитектурными решениями: Feature-Sliced Design (FSD) и явным разделением клиентского и серверного кода. Каждому правилу присвоен уникальный идентификатор (ID) для удобства ссылок и автоматизации.

---

### - S-L / Правила Структуры и Взаимодействия Слоев

```yaml
- id: S-01
  каталог: './'
  правило: 'В корне проекта разрешены только каталоги: app/, domains/, shared/, widgets/, features/, entities/, public/, scripts/, memory-bank/.'

- id: L-01
  каталог: 'app/'
  файл: '**/*'
  правило: 'Может импортировать из `domains`, `widgets`, `features`, `entities`, `shared`.'

- id: L-02
  каталог: 'domains/'
  файл: '**/*'
  правило: 'Может импортировать только из `shared` и модулей внутри того же домена. ЗАПРЕЩЕНО импортировать из других доменов, а также из `app/`, `widgets/`.'

- id: L-03
  каталог: 'widgets/'
  файл: '**/*'
  правило: 'Может импортировать из `features`, `entities`, `shared`. ЗАПРЕЩЕНО импортировать из `app/` и других `widgets/`.'

- id: L-04
  каталог: 'features/'
  файл: '**/*'
  правило: 'Может импортировать из `entities`, `shared`. ЗАПРЕЩЕНО импортировать из `app/`, `widgets/`.'

- id: L-05
  каталог: 'entities/'
  файл: '**/*'
  правило: 'Может импортировать только из `shared`. ЗАПРЕЩЕНО импортировать из `app/`, `widgets/`, `features/`.'

- id: L-06
  каталог: 'shared/'
  файл: '**/*'
  правило: 'Не может импортировать из других слоев проекта (`app`, `domains`, `widgets`, и т.д.). Может импортировать только из `node_modules` и других модулей внутри `shared/`.'
```

### - D / Правила Внутренней Структуры Домена

```yaml
- id: D-01
  каталог: 'domains/*/'
  файл: 'index.ts'
  правило: 'Клиентский Public API. Должен экспортировать только client-safe сущности (UI-компоненты, типы, константы). ЗАПРЕЩЕНО экспортировать серверный код.'

- id: D-02
  каталог: 'domains/*/'
  файл: 'index.server.ts'
  правило: 'Серверный Public API. Должен экспортировать server-only сущности (`actions`, `queries`, серверные сервисы).'

- id: D-03
  каталог: 'domains/*/actions/'
  файл: '*.server.ts'
  правило: 'Файлы должны содержать Server Actions и иметь директиву `"use server"`.'

- id: D-04
  каталог: 'domains/*/data/'
  файл: '*.repo.server.ts'
  правило: 'Единственное место для прямых запросов к БД (ORM). Должен быть серверным.'

- id: D-05
  каталог: 'domains/*/features/'
  файл: '*.server.ts'
  правило: 'Оркестраторы бизнес-логики, координирующие `actions` и `data`. Пример: `crud.server.ts`.'

- id: D-06
  каталог: 'domains/*/lib/'
  файл: '**/*.ts'
  правило: 'Должны содержать только чистые функции, специфичные для домена.'

- id: D-07
  каталог: 'domains/*/model/'
  файл: '**/*.ts'
  правило: 'Содержат определения данных, константы, enums, используемые в домене.'

- id: D-08
  каталог: 'domains/*/'
  файл: 'orm.server.ts'
  правило: 'Содержит Drizzle ORM схему (таблицы, связи) для домена.'

- id: D-09
  каталог: 'domains/*/'
  файл: 'types.shared.ts'
  правило: 'Содержит Zod-схемы и типы, безопасные для передачи между сервером и клиентом.'

- id: D-10
  каталог: 'domains/*/ui/'
  файл: '*.client.tsx'
  правило: 'Файлы должны быть React-компонентами с директивой `"use client"`.'
```

### - C / Правила Именования и Директив (Conventions)

```yaml
- id: C-01
  каталог: '**/'
  файл: '*.server.{ts,tsx}'
  правило: 'Серверные файлы. Код выполняется только на сервере. ЗАПРЕЩЕНО использовать Browser API (`window`, `document`) и React-хуки (`useState`, `useEffect`).'

- id: C-02
  каталог: '**/'
  файл: '**/*'
  правило: 'Для файлов, содержащих директиву `// server-only`: Гарантирует, что модуль не попадет в клиентский бандл. ЗАПРЕЩЕНО импортировать такие модули в файлы, не являющиеся серверными.'

- id: C-03
  каталог: '**/'
  файл: '*.server.ts'
  правило: 'Для файлов, содержащих директиву `"use server"`: Помечает экспорт(ы) файла как Server Actions.'

- id: C-04
  каталог: '**/'
  файл: '*.client.{ts,tsx}'
  правило: 'Клиентские файлы. Код выполняется только в браузере. ЗАПРЕЩЕНО использовать Node.js API и прямой доступ к БД.'

- id: C-05
  каталог: '**/'
  файл: '**/*'
  правило: 'Для файлов, содержащих директиву `"use client"`: Помечает модуль как клиентский. ЗАПРЕЩЕНО использовать в файлах, предназначенных для выполнения на сервере (`.server.ts`).'

- id: C-06
  каталог: '**/'
  файл: '*.shared.ts'
  правило: 'Общие файлы. Код безопасен для выполнения на сервере и клиенте. ЗАПРЕЩЕНО импортировать `server-only` или `client-only` модули.'
```
